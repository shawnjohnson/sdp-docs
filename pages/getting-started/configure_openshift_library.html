

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuring the OpenShift Library &mdash; Solutions Delivery Platform  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Create Organizational Pipeline" href="create_org_pipeline.html" />
    <link rel="prev" title="Configure SDP" href="configure_sdp.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Solutions Delivery Platform
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="create_github_organization.html">Create a GitHub Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_pipeline_config_repo.html">Create a Pipeline Configuration Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="clone_sdp_repo.html">Clone The SDP Deployment Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure_jenkins_in_chart.html">Configure Jenkins Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="deploy_sdp.html">Deploy SDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure_sdp.html">Configure SDP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Configuring the OpenShift Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_org_pipeline.html">Create Organizational Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="configure_tenant_repo.html">Configure a Tenant Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="verify.html">Verify</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../libraries/index.html">Pipeline Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jte/docs/index.html">Jenkins Templating Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../labs/index.html">Learning Labs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment-guides/index.html">Deployment Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/index.html">How-To’s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute-to-docs.html">Contribute to the Docs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Solutions Delivery Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Getting Started</a> &raquo;</li>
        
      <li>Configuring the OpenShift Library</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/pages/getting-started/configure_openshift_library.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  





<div class="section" id="configuring-the-openshift-library">
<span id="configure-openshift-library"></span><h1>Configuring the OpenShift Library<a class="headerlink" href="#configuring-the-openshift-library" title="Permalink to this headline">¶</a></h1>
<p>Your cluster permissions are how you achieve multitenancy with SDP.</p>
<p>To prepare a multitenant configuration of OpenShift for SDP we need to set up the following:</p>
<ul class="simple">
<li>A project per application environment per isolated tenant</li>
<li>An installation of Tiller per tenant</li>
<li>An OpenShift project to store the image streams for archived container images</li>
<li>RBAC configuration for these projects.</li>
<li>A Helm configuration repository to store the chart(s) for a tenant (or group of tenants)</li>
</ul>
<div class="section" id="preparing-the-openshift-environment">
<h2>Preparing The OpenShift Environment<a class="headerlink" href="#preparing-the-openshift-environment" title="Permalink to this headline">¶</a></h2>
<p>We have automated the provisioning of application environments, helm, and a project to archive container images with the appropriate multitenant RBAC configuration via a script in the SDP deployment repository - <code class="docutils literal"><span class="pre">/resources/helm/provision_app_envs.sh</span></code>.</p>
<p>To see the available options run:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">provision_app_envs</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>For our example, we will create a set of demo application environments (<code class="docutils literal"><span class="pre">dev</span></code> and <code class="docutils literal"><span class="pre">prod</span></code>), and store the images in a project called <code class="docutils literal"><span class="pre">demo</span></code></p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">provision_app_envs</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">p</span> <span class="n">demo</span> <span class="o">-</span><span class="n">e</span> <span class="n">dev</span> <span class="o">-</span><span class="n">e</span> <span class="n">prod</span> <span class="o">-</span><span class="n">i</span> <span class="n">demo</span>
</pre></div>
</div>
<p>This will create the following projects:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Provisioned OpenShift Infrastructure</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Project</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>demo-dev</td>
<td>The Development application environment</td>
</tr>
<tr class="row-odd"><td>demo-prod</td>
<td>The Production application environment</td>
</tr>
<tr class="row-even"><td>demo-tiller</td>
<td>The tiller namespace</td>
</tr>
<tr class="row-odd"><td>demo</td>
<td>The project where we will configure SDP to push container images</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you modify the command above to create projects with different names, be sure to continue using those names as you follow this guide. For example if you enter <code class="docutils literal"><span class="pre">bash</span> <span class="pre">provision_app_envs.sh</span> <span class="pre">-p</span> <span class="pre">foo</span> <span class="pre">-e</span> <span class="pre">dev</span> <span class="pre">-e</span> <span class="pre">prod</span> <span class="pre">-i</span> <span class="pre">bar</span></code>, use “foo-tiller” instead of “demo-tiller” and use “bar” for your application_image_repository.</p>
</div>
<p>Now, we can begin to configure this in the organizational <em>pipeline_config.groovy</em> file. We will need to add the application environments and configure the OpenShift library.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">sdp_image_repository</span> <span class="o">=</span> <span class="s2">&quot;https://docker-registry.default.svc:5000&quot;</span>
<span class="n">sdp_image_repository_credential</span> <span class="o">=</span> <span class="s2">&quot;sdp-jenkins-docker-registry&quot;</span>

<span class="n">application_image_repository</span> <span class="o">=</span> <span class="s2">&quot;docker-registry.default.svc:5000/demo&quot;</span>
<span class="n">application_image_repository_credential</span> <span class="o">=</span> <span class="s2">&quot;sdp-jenkins-docker-registry&quot;</span>

<span class="n">application_environments</span><span class="p">{</span>
    <span class="n">dev</span><span class="p">{</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="s2">&quot;dev&quot;</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Development&quot;</span>
    <span class="p">}</span>
    <span class="n">prod</span><span class="p">{</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="s2">&quot;prod&quot;</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Production&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">libraries</span><span class="p">{</span>
  <span class="n">github_enterprise</span>
  <span class="n">sonarqube</span>
  <span class="n">docker</span>
  <span class="n">openshift</span><span class="p">{</span>
    <span class="n">url</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">openshift</span> <span class="n">url</span><span class="o">&gt;</span> <span class="o">//</span> <span class="k">for</span> <span class="n">example</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">master</span><span class="o">.</span><span class="n">oscp</span><span class="o">.</span><span class="n">microcaas</span><span class="o">.</span><span class="n">net</span><span class="p">:</span><span class="mi">8443</span>
    <span class="n">tiller_namespace</span> <span class="o">=</span> <span class="s2">&quot;demo-tiller&quot;</span>
    <span class="n">tiller_credential</span> <span class="o">=</span> <span class="s2">&quot;demo-tiller&quot;</span>
  <span class="p">}</span>
  <span class="n">owasp_zap</span><span class="p">{</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="n">true</span>
  <span class="p">}</span>
  <span class="n">a11y</span><span class="p">{</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="n">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Create a Jenkins Credential with ID ``demo-tiller``</strong></p>
<p>For the OpenShift library to authenticate and perform a deployment via Helm, it uses a Jenkins credential.</p>
<p>Follow <a class="reference internal" href="../how-to/add_jenkins_credentials.html#add-credentials-to-jenkins"><span class="std std-ref">this guide</span></a> to create a username/password credential in Jenkins with the username: <code class="docutils literal"><span class="pre">system:serviceaccount:demo-tiller:tiller</span></code></p>
<p>To get the password, you’ll have to get a service account token from the tiller service account:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">oc</span> <span class="n">sa</span> <span class="n">get</span><span class="o">-</span><span class="n">token</span> <span class="n">tiller</span> <span class="o">-</span><span class="n">n</span> <span class="n">demo</span><span class="o">-</span><span class="n">tiller</span>
</pre></div>
</div>
<p>copy the token and paste it into Jenkins.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">make sure you set the credential ID to demo-tiller, as referenced in your configuration file.</p>
</div>
</div>
<div class="section" id="creating-the-helm-configuration-repository">
<h2>Creating the Helm Configuration Repository<a class="headerlink" href="#creating-the-helm-configuration-repository" title="Permalink to this headline">¶</a></h2>
<p>To achieve disaster recovery, auditability, rollbacks, and infrastructure as code, the OpenShift library deploys
applications using Helm from a chart stored in a GitHub repository.</p>
<p>Create a GitHub repository. This repository can be under any GitHub account or organization, but it makes sense
to create the repository inside the GitHub organization created in the first step, or in the same organization
as your applications if you opted to use a pre-existing one. Name it whatever you like, but <code class="docutils literal"><span class="pre">helm-configuration-repository</span></code>
makes sense. It can be public or private, so long as the GitHub account Jenkins is using can read <em>and</em> write.</p>
<p>Add this repository to your configuration file, which should now look like:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">sdp_image_repository</span> <span class="o">=</span> <span class="s2">&quot;https://docker-registry.default.svc:5000&quot;</span>
<span class="n">sdp_image_repository_credential</span> <span class="o">=</span> <span class="s2">&quot;sdp-jenkins-docker-registry&quot;</span>

<span class="n">application_image_repository</span> <span class="o">=</span> <span class="s2">&quot;docker-registry.default.svc:5000/demo&quot;</span>
<span class="n">application_image_repository_credential</span> <span class="o">=</span> <span class="s2">&quot;sdp-jenkins-docker-registry&quot;</span>

<span class="n">application_environments</span><span class="p">{</span>
    <span class="n">dev</span><span class="p">{</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="s2">&quot;dev&quot;</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Development&quot;</span>
    <span class="p">}</span>
    <span class="n">prod</span><span class="p">{</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="s2">&quot;prod&quot;</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="s2">&quot;Production&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">libraries</span><span class="p">{</span>
  <span class="n">github_enterprise</span>
  <span class="n">sonarqube</span>
  <span class="n">docker</span>
  <span class="n">openshift</span><span class="p">{</span>
    <span class="n">url</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">openshift</span> <span class="n">url</span><span class="o">&gt;</span> <span class="o">//</span> <span class="k">for</span> <span class="n">example</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">master</span><span class="o">.</span><span class="n">oscp</span><span class="o">.</span><span class="n">microcaas</span><span class="o">.</span><span class="n">net</span><span class="p">:</span><span class="mi">8443</span>
    <span class="n">tiller_namespace</span> <span class="o">=</span> <span class="s2">&quot;demo-tiller&quot;</span>
    <span class="n">tiller_credential</span> <span class="o">=</span> <span class="s2">&quot;demo-tiller&quot;</span>
    <span class="n">helm_configuration_repository</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">url</span> <span class="n">to</span> <span class="n">your</span> <span class="n">helm</span> <span class="n">repo</span><span class="o">&gt;</span> <span class="o">//</span> <span class="k">for</span> <span class="n">example</span><span class="p">:</span> <span class="s2">&quot;https://github.boozallencsn.com/Red-Hat-Summit/helm-configuration.git&quot;</span>
    <span class="n">helm_configuration_repository_credential</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">Jenkins</span> <span class="n">credential</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">access</span> <span class="n">repo</span><span class="o">&gt;</span> <span class="o">//</span> <span class="n">probably</span> <span class="s2">&quot;github&quot;</span>
  <span class="p">}</span>
  <span class="n">owasp_zap</span><span class="p">{</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="n">true</span>
  <span class="p">}</span>
  <span class="n">a11y</span><span class="p">{</span>
    <span class="n">merge</span> <span class="o">=</span> <span class="n">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize-helm-repository">
<h2>Initialize Helm Repository<a class="headerlink" href="#initialize-helm-repository" title="Permalink to this headline">¶</a></h2>
<p>Jenkins will clone this repository and push updates to it to perform deployments and record which versions of container
images are deployed to each application environment. You can initialize a helm chart with the <code class="docutils literal"><span class="pre">helm</span> <span class="pre">create</span></code> command.</p>
<p>Assuming you’ve created an empty GitHub repository for your helm chart, you can run:</p>
<div class="code shell highlight-default"><div class="highlight"><pre><span></span><span class="n">helm</span> <span class="n">create</span> <span class="o">&lt;</span><span class="n">repo_name</span><span class="o">&gt;</span>
<span class="n">cd</span> <span class="o">&lt;</span><span class="n">repo_name</span><span class="o">&gt;</span>
<span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">origin</span> <span class="o">&lt;</span><span class="n">helm</span> <span class="n">repo</span> <span class="n">url</span><span class="o">&gt;</span>
<span class="n">git</span> <span class="n">add</span> <span class="o">--</span><span class="nb">all</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;initializing chart repo&quot;</span>
<span class="n">git</span> <span class="n">push</span> <span class="o">-</span><span class="n">u</span> <span class="n">origin</span> <span class="n">master</span>
</pre></div>
</div>
<p>Once that’s done you should</p>
<ol class="arabic simple">
<li>Delete the yaml files that were automatically created when <code class="docutils literal"><span class="pre">helm</span> <span class="pre">create</span></code> was called. These are example helm templates, and we don’t need them.</li>
<li>Delete the contents of templates/_helpers.tpl and templates/NOTES.txt. We want to keep those files, but provide our own content.</li>
<li>Update <em>Chart.yaml</em> to properly describe your new chart.</li>
</ol>
<p>For more information on Helm charts, check out the <a href="https://docs.helm.sh/developing_charts/" target="_blank">Helm documentation</a>.</p>
</div>
<div class="section" id="sdp-helm-conventions">
<h2>SDP Helm Conventions<a class="headerlink" href="#sdp-helm-conventions" title="Permalink to this headline">¶</a></h2>
<p>SDP pushes and pulls to this chart repository to keep it up to date with the image tags of deployed containers.</p>
<p>For each application repository that SDP will be building, add this to the values.yaml file under an <code class="docutils literal"><span class="pre">image_shas</span></code> key.</p>
<p>For example, if there was a repository called <code class="docutils literal"><span class="pre">sample-app</span></code>, your <code class="docutils literal"><span class="pre">values.yaml</span></code> would include:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">image_shas</span><span class="p">:</span>
    <span class="n">sample_app</span><span class="p">:</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Because YAML key’s cannot contain hyphens, any hyphens in repository names should be converted to underscores.</p>
</div>
<p>Your template would then be able to specify the image for a deployment via:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">image</span><span class="p">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">svc</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">sample</span><span class="o">-</span><span class="n">app</span><span class="p">:{{</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">image_shas</span><span class="o">.</span><span class="n">sample_app</span> <span class="p">}}</span>
</pre></div>
</div>
<p>At this point, you should take some time to finish fleshing out your Helm chart to reflect how you wish to deploy your app.</p>
</div>
<div class="section" id="create-a-values-file-per-environment">
<h2>Create a Values File Per Environment<a class="headerlink" href="#create-a-values-file-per-environment" title="Permalink to this headline">¶</a></h2>
<p>In addition to the <em>values.yaml</em> file created when <code class="docutils literal"><span class="pre">helm</span> <span class="pre">create</span></code> was run, you should make a <em>values.&lt;APP_ENV&gt;.yaml</em> file for each application environment you created at the top of this page. Be sure to substitute <em>&lt;APP_ENV&gt;</em> with the <code class="docutils literal"><span class="pre">short_name</span></code> of the application environment. For example, if you created a <em>dev</em> and <em>prod</em> environment, you might create those files with the command:</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">values</span><span class="o">.</span><span class="n">yaml</span> <span class="n">values</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">yaml</span>
<span class="n">cp</span> <span class="n">values</span><span class="o">.</span><span class="n">yaml</span> <span class="n">values</span><span class="o">.</span><span class="n">prod</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>The purpose of these separate files is so that you can provide your separate configurations (database URLs, names, etc.) for different environments. Now, whenever you use the <code class="docutils literal"><span class="pre">deploy_to</span> <span class="pre">dev</span></code> step in your pipeline, it will deploy a helm chart using <em>values.dev.yaml</em>.</p>
<p>The SDP will automatically update the image sha value discussed earlier, but you should now modify the different values.yaml files with environment-specifc variables.</p>
</div>
<div class="section" id="example-helm-configuration-with-forked-sdp-website">
<h2>Example Helm Configuration With Forked SDP-Website<a class="headerlink" href="#example-helm-configuration-with-forked-sdp-website" title="Permalink to this headline">¶</a></h2>
<p>If you forked the SDP-Website repo earlier to follow along with this guide these are the changes that you would need to make after running the <code class="docutils literal"><span class="pre">helm</span> <span class="pre">create</span></code> command.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>helm_configuration_repository
├── templates/
│   ├── _helpers.tpl
│   ├── frontend.yaml
│   └── NOTES.txt
├── .helmignore
├── Chart.yaml
├── README.md (optional)
├── values.dev.yaml
├── values.prod.yaml
└── values.yaml
</pre></div>
</div>
<p>Where the following adjustments have been made to files created with the <code class="docutils literal"><span class="pre">helm</span> <span class="pre">create</span></code> command:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be sure to commit push your changes up to Github once you’ve finished.</p>
</div>
<div class="section" id="helpers-tpl">
<h3>_helpers.tpl<a class="headerlink" href="#helpers-tpl" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="o">/*</span> <span class="n">Determines</span> <span class="n">Namespace</span> <span class="n">Based</span> <span class="n">on</span> <span class="n">Ephemerality</span> <span class="o">*/</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="n">define</span> <span class="s2">&quot;determine_namespace&quot;</span> <span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="k">if</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">is_ephemeral</span> <span class="p">}}</span>
<span class="n">namespace</span><span class="p">:</span> <span class="p">{{</span> <span class="o">.</span><span class="n">Release</span><span class="o">.</span><span class="n">Name</span> <span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="k">else</span> <span class="p">}}</span>
<span class="n">namespace</span><span class="p">:</span> <span class="p">{{</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">namespace</span> <span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="n">end</span> <span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="n">end</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="notes-txt">
<h3>NOTES.txt<a class="headerlink" href="#notes-txt" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Finished</span> <span class="n">installing</span> <span class="n">SDP</span><span class="o">-</span><span class="n">Website</span>
</pre></div>
</div>
<p>This file contains text that is displayed after the chart is successfully installed.</p>
</div>
<div class="section" id="chart-yaml">
<h3>Chart.yaml<a class="headerlink" href="#chart-yaml" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">name:</span> <span class="pre">.</span></code> changed to <code class="docutils literal"><span class="pre">name:</span> <span class="pre">helm-configuration-repository</span></code></p>
<p>The following files were created manually:</p>
</div>
<div class="section" id="frontend-yaml">
<h3>frontend.yaml<a class="headerlink" href="#frontend-yaml" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kind</span><span class="p">:</span> <span class="n">List</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
<span class="n">items</span><span class="p">:</span>

<span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">DeploymentConfig</span>
  <span class="n">apiVersion</span><span class="p">:</span>  <span class="n">apps</span><span class="o">.</span><span class="n">openshift</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
  <span class="n">metadata</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="p">{{</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">namespace</span> <span class="p">}}</span>
    <span class="n">labels</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">frontend</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
  <span class="n">spec</span><span class="p">:</span>
    <span class="n">replicas</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">selector</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">frontend</span>
      <span class="n">deploymentconfig</span><span class="p">:</span> <span class="n">frontend</span>
    <span class="n">triggers</span><span class="p">:</span>
      <span class="o">-</span> <span class="nb">type</span><span class="p">:</span> <span class="n">ConfigChange</span>
    <span class="n">template</span><span class="p">:</span>
      <span class="n">metadata</span><span class="p">:</span>
        <span class="n">labels</span><span class="p">:</span>
          <span class="n">app</span><span class="p">:</span> <span class="n">frontend</span>
          <span class="n">deploymentconfig</span><span class="p">:</span> <span class="n">frontend</span>
      <span class="n">spec</span><span class="p">:</span>
        <span class="n">containers</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">image</span><span class="p">:</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">svc</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">demo</span><span class="o">/</span><span class="n">sdp</span><span class="o">-</span><span class="n">website</span><span class="p">:{{</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">image_shas</span><span class="o">.</span><span class="n">sdp_website</span> <span class="p">}}</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
          <span class="n">volumeMounts</span><span class="p">:</span>
              <span class="o">-</span> <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">nginx</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">nginx</span><span class="o">-</span><span class="n">cache</span>
        <span class="n">ports</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
          <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">8080</span>
          <span class="n">targetPort</span><span class="p">:</span> <span class="mi">8080</span>
          <span class="n">nodePort</span><span class="p">:</span> <span class="mi">0</span>
        <span class="n">volumes</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nginx</span><span class="o">-</span><span class="n">cache</span>
          <span class="n">emptyDir</span><span class="p">:</span> <span class="p">{}</span>

<span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
  <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
  <span class="n">metadata</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="p">{{</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">namespace</span> <span class="p">}}</span>
  <span class="n">spec</span><span class="p">:</span>
    <span class="n">ports</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">web</span>
      <span class="n">protocol</span><span class="p">:</span> <span class="n">TCP</span>
      <span class="n">port</span><span class="p">:</span> <span class="mi">8080</span>
      <span class="n">targetPort</span><span class="p">:</span> <span class="mi">8080</span>
      <span class="n">nodePort</span><span class="p">:</span> <span class="mi">0</span>
    <span class="n">selector</span><span class="p">:</span>
      <span class="n">app</span><span class="p">:</span> <span class="n">frontend</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">ClusterIP</span>
    <span class="n">sessionAffinity</span><span class="p">:</span> <span class="kc">None</span>

<span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">Route</span>
  <span class="n">apiVersion</span><span class="p">:</span> <span class="s2">&quot;route.openshift.io/v1&quot;</span>
  <span class="n">metadata</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="p">{{</span> <span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">namespace</span> <span class="p">}}</span>
  <span class="n">spec</span><span class="p">:</span>
    <span class="n">host</span><span class="p">:</span> <span class="s2">&quot;frontend-{{ .Release.Name }}.apps.oscp.microcaas.net&quot;</span>
    <span class="n">to</span><span class="p">:</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">Service</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">frontend</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">-</span> <span class="pre">image:</span> <span class="pre">docker-registry.default.svc:5000/demo/sdp-website:{{</span> <span class="pre">.Values.image_shas.sdp_website</span> <span class="pre">}}</span></code> should reflect the repository site in the organizational <em>pipeline_config.groovy</em> file for your <code class="docutils literal"><span class="pre">application_image_repository</span></code> variable.
E.g. if you had created your application environments using <code class="docutils literal"><span class="pre">bash</span> <span class="pre">provision_app_envs.sh</span> <span class="pre">-p</span> <span class="pre">foo</span> <span class="pre">-e</span> <span class="pre">dev</span> <span class="pre">-e</span> <span class="pre">prod</span> <span class="pre">-i</span> <span class="pre">bar</span></code> then your <code class="docutils literal"><span class="pre">application_image_repository</span></code> in the organizational <em>pipeline_config.groovy</em> file would be look like
<code class="docutils literal"><span class="pre">application_image_repository</span> <span class="pre">=</span> <span class="pre">&quot;docker-registry.default.svc:5000/bar&quot;</span></code> so your image value in the above yaml file would look like <code class="docutils literal"><span class="pre">-</span> <span class="pre">image:</span> <span class="pre">docker-registry.default.svc:5000/bar/sdp-website:{{</span> <span class="pre">.Values.image_shas.sdp_website</span> <span class="pre">}}</span></code>. Note the switch from
<em>/demo/sdp-website</em> to <em>/bar/sdp-website</em>.</p>
</div>
</div>
<div class="section" id="values-dev-yaml">
<h3>values.dev.yaml<a class="headerlink" href="#values-dev-yaml" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">namespace</span><span class="p">:</span> <span class="n">demo</span><span class="o">-</span><span class="n">dev</span> <span class="c1"># if your tiller server is foo-tiller this is probably foo-dev</span>
<span class="n">image_shas</span><span class="p">:</span>
    <span class="n">sdp_website</span><span class="p">:</span>
</pre></div>
</div>
</div>
<div class="section" id="values-prod-yaml">
<h3>values.prod.yaml<a class="headerlink" href="#values-prod-yaml" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">namespace</span><span class="p">:</span> <span class="n">demo</span><span class="o">-</span><span class="n">prod</span> <span class="c1"># if your tiller server is foo-tiller this is probably foo-dev</span>
<span class="n">image_shas</span><span class="p">:</span>
    <span class="n">sdp_website</span><span class="p">:</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create_org_pipeline.html" class="btn btn-neutral float-right" title="Create Organizational Pipeline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configure_sdp.html" class="btn btn-neutral" title="Configure SDP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Booz Allen Hamilton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: master
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../master/pages/getting-started/configure_openshift_library.html">master</a></dd>
        </dl>
    </div>
</div>


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>